<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Robin Denz" />


<title>Simulating Covid-19 Vaccine Data using a Discrete-Time Simulation</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Simulating Covid-19 Vaccine Data using a
Discrete-Time Simulation</h1>
<h4 class="author">Robin Denz</h4>


<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#how-to-get-started" id="toc-how-to-get-started">How to get
started</a>
<ul>
<li><a href="#formulate-the-goal-of-your-research-project-in-a-detailed-fashion." id="toc-formulate-the-goal-of-your-research-project-in-a-detailed-fashion."><strong>1.)</strong>
Formulate the goal of your research project in a detailed
fashion.</a></li>
<li><a href="#build-a-theoretical-model-of-the-system-you-want-to-simulate." id="toc-build-a-theoretical-model-of-the-system-you-want-to-simulate."><strong>2.)</strong>
Build a theoretical model of the system you want to simulate.</a></li>
<li><a href="#identify-the-parts-of-the-system-that-you-are-most-interested-in." id="toc-identify-the-parts-of-the-system-that-you-are-most-interested-in."><strong>3.)</strong>
Identify the parts of the system that you are most interested
in.</a></li>
<li><a href="#obtain-and-analyze-real-data." id="toc-obtain-and-analyze-real-data."><strong>4.)</strong> Obtain and
analyze real data.</a></li>
<li><a href="#simulate-data-for-t-0-if-needed." id="toc-simulate-data-for-t-0-if-needed."><strong>5.)</strong> Simulate
data for <span class="math inline">\(t = 0\)</span> (if
needed).</a></li>
<li><a href="#write-functions-for-each-time-varying-node-one-at-a-time." id="toc-write-functions-for-each-time-varying-node-one-at-a-time."><strong>6.)</strong>
Write functions for each time-varying node, one at a time.</a></li>
<li><a href="#inspect-the-resulting-data-for-inconsistencies." id="toc-inspect-the-resulting-data-for-inconsistencies."><strong>7.)</strong>
Inspect the resulting data for inconsistencies.</a></li>
</ul></li>
<li><a href="#our-research-goal-and-the-theoretical-model" id="toc-our-research-goal-and-the-theoretical-model">Our research goal
and the theoretical model</a>
<ul>
<li><a href="#research-goal" id="toc-research-goal">Research
goal</a></li>
<li><a href="#theoretical-model" id="toc-theoretical-model">Theoretical
model</a></li>
</ul></li>
<li><a href="#implementing-the-model" id="toc-implementing-the-model">Implementing the model</a>
<ul>
<li><a href="#part-1-adding-vaccination-covid-and-sickness" id="toc-part-1-adding-vaccination-covid-and-sickness">Part 1: Adding
vaccination, covid and sickness</a></li>
<li><a href="#part-2-adding-adverse-effects-of-vaccination-and-covid" id="toc-part-2-adding-adverse-effects-of-vaccination-and-covid">Part 2:
Adding adverse effects of vaccination and covid</a></li>
<li><a href="#part-3-making-the-vaccine-useful" id="toc-part-3-making-the-vaccine-useful">Part 3: Making the vaccine
useful</a></li>
<li><a href="#part-4-sick-people-dont-get-vaccinated" id="toc-part-4-sick-people-dont-get-vaccinated">Part 4: Sick people
don’t get vaccinated</a></li>
<li><a href="#generating-data-using-the-final-model" id="toc-generating-data-using-the-final-model">Generating Data using the
final model</a></li>
<li><a href="#going-even-further" id="toc-going-even-further">Going even
further</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This vignette contains an in-depth example on how to use the
<code>sim_discrete_time()</code> function to generate complex
time-to-event data. Unlike the other vignettes, we will not rely on a
overly simple example here. Instead, our aim is to generate somewhat
realistic data about the Covid-19 pandemic. In particular, we are
interested in generating a longitudinal data set containing Covid-19
infections, vaccines and adverse side effects of those vaccines. The aim
of the real study was to create a data set that is reasonably close to
real data, including measurement problems as described below. This data
generation algorithm was then used to identify a suitable data analysis
strategy for the real data. We only describe a slightly simplified
version of the data generation part here to give a detailed example on
how the <code>sim_discrete_time()</code> function may be used
effectively.</p>
<p>Note that the algorithm described here is not completely the same as
the one we originally used, because that would require us to include
confidential data into this vignette, which is sadly impossible.</p>
<p>We also strongly recommend reading the other two vignettes of this
package first.</p>
</div>
<div id="how-to-get-started" class="section level1">
<h1>How to get started</h1>
<p>Simulating data that is reasonably close to a complex real system is
not a trivial task, even when using this package. Dividing the big task
of obtaining a valid data generation model into multiple sub-tasks is a
great first step in the right direction. We suggest following the 7
steps below:</p>
<div id="formulate-the-goal-of-your-research-project-in-a-detailed-fashion." class="section level2">
<h2><strong>1.)</strong> Formulate the goal of your research project in
a detailed fashion.</h2>
<p>If you haven’t done this yet, now is the time. Try to make your goal
as explicit as possible. This will help you in deciding which aspects of
the system are important to you and which can be safely ignored.</p>
</div>
<div id="build-a-theoretical-model-of-the-system-you-want-to-simulate." class="section level2">
<h2><strong>2.)</strong> Build a theoretical model of the system you
want to simulate.</h2>
<p>This entails reading up on relevant literature and writing down any
assumptions you may already have about the system. Perhaps (and usually
most likely) other researchers have tried to build a simulation model
for the same system (or a very similar system). A great way to encode
your causal assumptions of the system is time-dependent DAG, as
discussed in the other vignettes.</p>
</div>
<div id="identify-the-parts-of-the-system-that-you-are-most-interested-in." class="section level2">
<h2><strong>3.)</strong> Identify the parts of the system that you are
most interested in.</h2>
<p>Real systems are incredibly complex. Any simulation will have to make
some simplifying assumptions. After building a moderately detailed
version of the theoretical model, you will have to decide which aspects
are of interest to your research project and which aren’t.</p>
</div>
<div id="obtain-and-analyze-real-data." class="section level2">
<h2><strong>4.)</strong> Obtain and analyze real data.</h2>
<p>If the simulated data should correspond to real data, it is crucial
to base the input of the model on actual empirical data. Using the
empirical data, you may be able to derive appropriate distributions for
the root nodes and appropriate functional forms of the relationship
between the considered variables.</p>
</div>
<div id="simulate-data-for-t-0-if-needed." class="section level2">
<h2><strong>5.)</strong> Simulate data for <span class="math inline">\(t
= 0\)</span> (if needed).</h2>
<p>After having specified suitable distributions and relationships,
generate the initial data used in the simulation process. It is
important to check this data thoroughly, as it will be used as a basis
for all subsequent steps of the simulation. The
<code>sim_from_dag()</code> function might be very helpful for this
step.</p>
</div>
<div id="write-functions-for-each-time-varying-node-one-at-a-time." class="section level2">
<h2><strong>6.)</strong> Write functions for each time-varying node, one
at a time.</h2>
<p>Each time-varying node requires a user written function that
transforms the data at <span class="math inline">\(t\)</span> to the
data at <span class="math inline">\(t + 1\)</span>. It might be helpful
to add one time-varying node at a time and proceeding to step
<strong>7.)</strong> before adding other variables, if possible.</p>
</div>
<div id="inspect-the-resulting-data-for-inconsistencies." class="section level2">
<h2><strong>7.)</strong> Inspect the resulting data for
inconsistencies.</h2>
<p>Validating your simulation code is important to ensure that no
mistakes slipped through. This may be done by fitting models relying on
your modeling assumptions to the generated data and checking whether
those models produce the expected results.</p>
</div>
</div>
<div id="our-research-goal-and-the-theoretical-model" class="section level1">
<h1>Our research goal and the theoretical model</h1>
<p>Since this vignette is mostly concerned with the practical
implementation of the discrete-time simulation approach using this
R-package, we will not spend too much time on the first 4 steps of the
process mentioned in the previous section. We only briefly present the
most important points.</p>
<div id="research-goal" class="section level2">
<h2>Research goal</h2>
<p>Our actual research goal was to identify a suitable data analysis
strategy for the assessment of Covid-19 vaccine side-effects for a
particular real-life data set. To do this we decided to simulate data
that is as close to the real data as possible. Using this data we could
then try out different analysis strategies and see which one performed
adequately. The goal for this vignette is to use parts of this model to
showcase the capabilities of the <code>simDAG</code> package. More
information on the actual simulation can be found in the first related
publication (Denz et al. 2023).</p>
</div>
<div id="theoretical-model" class="section level2">
<h2>Theoretical model</h2>
<p>There is a seemingly endless amount of literature describing models
for the Covid-19 pandemic and the associated Covid-19 vaccines. Trying
to include all relevant aspects would be an unfeasible task. After
deliberating on this literature we decided to include only a few key
variables. To make this vignette readable we further limited the
variables to only include the most essential:</p>
<ul>
<li><code>vaccination</code>: The time at which the person received the
first vaccine.</li>
<li><code>covid</code>: Whether a Covid-19 infection occurred.</li>
<li><code>sickness</code>: Whether the person has developed the sickness
of interest.</li>
</ul>
<p>We assume that these three variables vary over time and cause each
other.</p>
</div>
</div>
<div id="implementing-the-model" class="section level1">
<h1>Implementing the model</h1>
<p>Instead of diving in deep from the start and trying to include all
relevant variables with all relevant relationships at once, it is often
better to build a very simplified version first and to start adding more
and more stuff to it as we continue.</p>
<div id="part-1-adding-vaccination-covid-and-sickness" class="section level2">
<h2>Part 1: Adding vaccination, covid and sickness</h2>
<p>The most important variables for us are the <code>vaccination</code>,
the <code>covid</code>-19 infection and the <code>sickness</code>. All
of these are variables that have a certain probability of occurrence at
each point in time. Once they occur, they last for some duration
(e.g. someone being sick for two weeks or something similar). After the
event is over, there is usually some duration where the person is
“immune” to receiving the event again. This is a perfect case for using
a time-dependent node of type <code>&quot;time_to_event&quot;</code>.</p>
<p>We start out modeling every one of these variables as completely
independent of each other using the following DAG:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; Warning: Paket &#39;ggplot2&#39; wurde unter R Version 4.2.3 erstellt</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(simDAG)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty_dag</span>() <span class="sc">+</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;vaccination&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span><span class="fl">0.001</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">21</span>, <span class="at">immunity_duration=</span><span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;covid&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span><span class="fl">0.001</span>, <span class="at">event_duration=</span><span class="dv">30</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>          <span class="at">immunity_duration=</span><span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;sickness&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span><span class="fl">0.0001</span>,</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">2</span>, <span class="at">immunity_duration=</span><span class="dv">2</span>)</span></code></pre></div>
<p>In the DAG above, we supplied a constant value to each of the
<code>prob_fun</code> arguments, indicating that regardless of time and
other variables, each event has a constant probability of occurring on
each day. We set the <code>event_duration</code> of
<code>vaccination</code> to 21, because we want to model the time after
vaccination in which the risk for the adverse side-effect (e.g. the
<code>sickness</code>) is higher than usual later on. By setting the
<code>immunity_duration</code> of the <code>vaccination</code> to
<code>Inf</code>, we are currently only allowing the person to get one
vaccination over the entire time. The <code>sickness</code> is allowed
to occur again directly after it was over.</p>
</div>
<div id="part-2-adding-adverse-effects-of-vaccination-and-covid" class="section level2">
<h2>Part 2: Adding adverse effects of vaccination and covid</h2>
<p>We can make this data-generation process a little more interesting by
making both the <code>vaccination</code> and <code>covid</code> have an
effect on the probability of developing the sickness. We will do this by
simply raising the probability of occurrence of the
<code>sickness</code> by a constant factor whenever either a
<code>covid</code> or <code>vaccination</code> event is currently
happening. This can be done by formulating an appropriate
<code>prob_fun</code> for the <code>sickness</code> node:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>prob_sickness <span class="ot">&lt;-</span> <span class="cf">function</span>(data, rr_covid, rr_vacc, base_p) {</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="co"># multiply base probability by relevant RRs</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  p <span class="ot">&lt;-</span> base_p <span class="sc">*</span> rr_vacc<span class="sc">^</span>(data<span class="sc">$</span>vaccination_event) <span class="sc">*</span> rr_covid<span class="sc">^</span>(data<span class="sc">$</span>covid_event)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>}</span></code></pre></div>
<p>This works because any number to an exponent of 1 is itself, while
any number to an exponent of 0 is one. The
<code>vaccination_event</code> and <code>covid_event</code> columns are
always either <code>TRUE</code> (when an event is currently happening)
or <code>FALSE</code> (when no event is currently happening), which are
interpreted as 1 and 0 by R. Let’s update our DAG:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty_dag</span>() <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;vaccination&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span><span class="fl">0.001</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">21</span>, <span class="at">immunity_duration=</span><span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;covid&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span><span class="fl">0.001</span>, <span class="at">event_duration=</span><span class="dv">30</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>          <span class="at">immunity_duration=</span><span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;sickness&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span>prob_sickness,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>          <span class="at">parents=</span><span class="fu">c</span>(<span class="st">&quot;vaccination_event&quot;</span>, <span class="st">&quot;covid_event&quot;</span>),</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>          <span class="at">base_p=</span><span class="fl">0.0001</span>, <span class="at">rr_covid=</span><span class="fl">3.5</span>, <span class="at">rr_vacc=</span><span class="fl">3.24</span>,</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">2</span>, <span class="at">immunity_duration=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Instead of passing a constant value to the <code>prob_fun</code>
argument, we are now passing it the previously defined function. Because
our function has <code>base_p</code>, <code>rr_covid</code> and
<code>rr_vacc</code> as arguments without defaults, we have to specify
those in the <code>node_td</code> call as well. We keep the original
<code>base_p</code>, and set the relative risks to 3.5 and 3.24
respectively. Additionally, we have to set both the
<code>vaccination_event</code> and the <code>covid_event</code> columns
as <code>parents</code> now, because they are used in the
<code>prob_sickness</code> function.</p>
</div>
<div id="part-3-making-the-vaccine-useful" class="section level2">
<h2>Part 3: Making the vaccine useful</h2>
<p>So far we assumed that the <code>covid</code> infection probability
is unaffected by whether the person received the vaccine or not. We will
now change this by implementing a time-window after receiving the
vaccine in which the person cannot develop a <code>covid</code>
infection. Again, this can be done by defining an appropriate
<code>prob_fun</code> function, this time for the <code>covid</code>
node:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>prob_covid <span class="ot">&lt;-</span> <span class="cf">function</span>(data, base_p, vacc_duration) {</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">fifelse</span>(data<span class="sc">$</span>vaccination_time_since_last <span class="sc">&lt;</span> vacc_duration,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>               <span class="dv">0</span>, base_p, <span class="at">na=</span>base_p)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>}</span></code></pre></div>
<p>In this function we use the column
<code>vaccination_time_since_last</code>, which is a column that can
optionally be created in time-to-event nodes by setting
<code>time_since_last</code> to <code>TRUE</code>. So let’s again update
our DAG accordingly:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty_dag</span>() <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;vaccination&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span><span class="fl">0.001</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">21</span>, <span class="at">immunity_duration=</span><span class="cn">Inf</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>          <span class="at">time_since_last=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;covid&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span>prob_covid,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>          <span class="at">parents=</span><span class="fu">c</span>(<span class="st">&quot;vaccination_time_since_last&quot;</span>),</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>          <span class="at">base_p=</span><span class="fl">0.001</span>, <span class="at">vacc_duration=</span><span class="dv">80</span>, <span class="at">event_duration=</span><span class="dv">30</span>,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>          <span class="at">immunity_duration=</span><span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;sickness&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span>prob_sickness,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>          <span class="at">parents=</span><span class="fu">c</span>(<span class="st">&quot;vaccination_event&quot;</span>, <span class="st">&quot;covid_event&quot;</span>),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>          <span class="at">base_p=</span><span class="fl">0.0001</span>, <span class="at">rr_covid=</span><span class="fl">3.5</span>, <span class="at">rr_vacc=</span><span class="fl">3.24</span>,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">2</span>, <span class="at">immunity_duration=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Instead of just updating the <code>parents</code> and
<code>prob_fun</code> arguments of the <code>covid</code> node, we now
also had to set the <code>time_since_last</code> argument of the
<code>vaccination</code> node to <code>TRUE</code> as well to get the
required additional column. Our data-generation algorithm is getting
better now. But there is still a lot we can do.</p>
</div>
<div id="part-4-sick-people-dont-get-vaccinated" class="section level2">
<h2>Part 4: Sick people don’t get vaccinated</h2>
<p>In reality, very little people who were currently experiencing a
Covid-19 infection went and got the vaccine. In fact, this is absolutely
discouraged by doctors world-wide. To add this circumstance to the
model, we once again simply have to update the probability of receiving
a vaccination, by defining an appropriate <code>prob_fun</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>prob_vaccination <span class="ot">&lt;-</span> <span class="cf">function</span>(data, base_p) {</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">fifelse</span>(data<span class="sc">$</span>covid_event, <span class="dv">0</span>, base_p)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="fu">return</span>(p)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>}</span></code></pre></div>
<p>Using this function, the probability of getting vaccinated for any
individual that is currently experiencing a <code>covid</code> infection
is 0. Let’s update our DAG one more time to include these changes:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">empty_dag</span>() <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;vaccination&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>          <span class="at">prob_fun=</span>prob_vaccination,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>          <span class="at">parents=</span><span class="fu">c</span>(<span class="st">&quot;covid_event&quot;</span>), <span class="at">base_p=</span><span class="fl">0.001</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">21</span>, <span class="at">immunity_duration=</span><span class="cn">Inf</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>          <span class="at">time_since_last=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;covid&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span>prob_covid,</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>          <span class="at">parents=</span><span class="fu">c</span>(<span class="st">&quot;vaccination_time_since_last&quot;</span>),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>          <span class="at">base_p=</span><span class="fl">0.001</span>, <span class="at">vacc_duration=</span><span class="dv">80</span>, <span class="at">event_duration=</span><span class="dv">30</span>,</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>          <span class="at">immunity_duration=</span><span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  <span class="fu">node_td</span>(<span class="st">&quot;sickness&quot;</span>, <span class="at">type=</span><span class="st">&quot;time_to_event&quot;</span>, <span class="at">prob_fun=</span>prob_sickness,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>          <span class="at">parents=</span><span class="fu">c</span>(<span class="st">&quot;vaccination_event&quot;</span>, <span class="st">&quot;covid_event&quot;</span>),</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>          <span class="at">base_p=</span><span class="fl">0.0001</span>, <span class="at">rr_covid=</span><span class="fl">3.5</span>, <span class="at">rr_vacc=</span><span class="fl">3.24</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>          <span class="at">event_duration=</span><span class="dv">2</span>, <span class="at">immunity_duration=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Again we simply changed the <code>prob_fun</code> argument and added
the correct <code>parents</code> to the appropriate node. Our final
“DAG” looks like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">plot</span>(dag, <span class="at">mark_td_nodes=</span><span class="cn">FALSE</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; Lade nötigen Namensraum: ggforce</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Note that in this plot it doesn’t look like a classic DAG anymore,
because it has a bi-directional arrow between <code>covid</code> and
<code>vaccination</code> due to the time-dependent nature of their
relationship.</p>
</div>
<div id="generating-data-using-the-final-model" class="section level2">
<h2>Generating Data using the final model</h2>
<p>Suppose we are now pleased with the complexity of our data-generation
algorithm and want to simulate data from it. We can do this by simply
calling the <code>sim_discrete_time()</code> function on the specified
DAG:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">sim_discrete_time</span>(dag, <span class="at">n_sim=</span><span class="dv">1000</span>, <span class="at">max_t=</span><span class="dv">800</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">summary</span>(sim)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; A simDT object with:</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;   -  1000  observations</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt;   -  800  distinct points in time</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt;   -  3  time-varying variables in total</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt;   -  3  time_to_event nodes</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;   -  0  competing_events nodes</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; Only the last state of the simulation was saved.</span></span></code></pre></div>
<p>For exemplary purposes, we kind of arbitrarily used 1000 individuals
and let the simulation run for 800 days. By calling the
<code>plot()</code> method, we get a concise overview over the process
we simulated:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">plot</span>(sim, <span class="at">box_text_size=</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>A more useful output of the resulting data can be obtained using the
<code>sim2data()</code> function. For example, we could transform the
output to the start-stop format:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">sim2data</span>(sim, <span class="at">to=</span><span class="st">&quot;start_stop&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;         .id start  stop vaccination  covid sickness</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;       &lt;int&gt; &lt;int&gt; &lt;num&gt;      &lt;lgcl&gt; &lt;lgcl&gt;   &lt;lgcl&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;    1:     1     1   178       FALSE  FALSE    FALSE</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;    2:     1   179   199        TRUE  FALSE    FALSE</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;    3:     1   200   800       FALSE  FALSE    FALSE</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;    4:     2     1   501       FALSE  FALSE    FALSE</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt;    5:     2   502   531       FALSE   TRUE    FALSE</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt;   ---                                              </span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; 3466:  1000     1    47       FALSE  FALSE    FALSE</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; 3467:  1000    48    49       FALSE  FALSE     TRUE</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; 3468:  1000    50   131       FALSE  FALSE    FALSE</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; 3469:  1000   132   152        TRUE  FALSE    FALSE</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; 3470:  1000   153   800       FALSE  FALSE    FALSE</span></span></code></pre></div>
<p>As can be seen, we managed to implement a fairly complex
data-generation mechanism using only a few small function definitions
and a few lines of code, allowing us to generate a complex dataset with
three interdependent time-varying variables with only minimal
effort.</p>
</div>
<div id="going-even-further" class="section level2">
<h2>Going even further</h2>
<p>There is no need to stop here. We could make this simulation model
even more complex by implementing any of the following things:</p>
<ul>
<li>Adding time-dependent base-probabilities for
<code>vaccination</code>, <code>covid</code> and
<code>sickness</code></li>
<li>Adding different kinds of <code>vaccination</code>s, perhaps with
different effects on <code>covid</code> and/or
<code>sickness</code></li>
<li>Adding time-fixed variables such as <code>sex</code> which have an
effect on any of the other variables</li>
<li>Allowing multiple vaccinations</li>
<li>Changing the constant raising of the probabilities in the form of a
relative risk to a more realistic non-linear time-dependent relative
risk</li>
</ul>
<p>There are of course many more possible extensions, all of which can
be implemented by augmenting the respective <code>prob_fun</code>
arguments and updating the <code>dag</code> accordingly. In fact, in the
real monte-carlo simulation we conducted, that is exactly what we did.
We used empirical data to model time-dependent base-probabilities and
more. How much complexity you really need is completely up to you. We
hope that the <code>simDAG</code> package can help you with whatever you
need.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Banks, Jerry, John S. Carson II, Barry L. Nelson, and David M. Nicol
(2014). Discrete-Event System Simulation. Vol. 5. Edinburgh Gate:
Pearson Education Limited.</p>
<p>Denz, Robin, Katharina Meiszl, Peter Ihle, Doris F. Oberle, Ursula
Drechsel-Bäuerle, Katrin Scholz, Ingo Meyer and Nina Timmesfeld (2023).
“Impact of Record-Linkage Errors in Covid-19 Vaccine-Safety Analyses
using German Health-Care Data: A Simulation Study”. In:
arXiv:2310.15016</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
